<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AoSharedServiceLibrary: Consul Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AoSharedServiceLibrary
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Consul Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Consul Administrator</h1>
<p>Consul is responsible for Service Registration &amp; Discovery, as well as Key-Value Retrieval.</p>
<h2>Use</h2>
<p>We start by importing the necessary interfaces and establish the service factory. </p><pre class="fragment">#include "aossl/consul/consul_interface.h"
#include "aossl/consul/factory_consul.h"

ConsulComponentFactory consul_factory;
</pre><p>Next, we define a Service which represents the current instance of the code.</p>
<p>This contains an ID, a name, a connection, and a port number. Tags can be added or not: </p><pre class="fragment">ServiceInterface *s = consul_factory.get_service_interface("1", "test", "http://localhost/", "5555");
s-&gt;add_tag("Testing");
</pre><p>And build our Consul Admin, specifying the connection address: </p><pre class="fragment">ConsulInterface *ca = consul_factory.get_consul_interface("localhost:8500");
</pre><p>Now, we can register the currently running instance of a service with Consul </p><pre class="fragment">ca-&gt;register_service(*s);
</pre><p>And, we can unregister on shutdown: </p><pre class="fragment">ca-&gt;deregister_service(*s);
</pre><p>We can get and set key-value storage elements: </p><pre class="fragment">bool success = ca-&gt;set_config_value("Test", "123");
assert(success);

std::string test_val = ca-&gt;get_config_value("Test");
logging-&gt;debug(test_val);
</pre><p>The Consul Admin also supports querying available services, nodes, and datacenters. Please see the API documentation for all available queries, as well as the <a href="https://www.consul.io/api/index.html">Consul HTTP API</a> for details on expected responses.</p>
<p>All responses from the Consul Admin are strings which hold the JSON response from the Consul HTTP API. Configuration Values retrieved from the KV store in Consul are also returned as JSON, and the value returned is encoded in base64. A convenience method is provided for decoding the text from base64. Please see the Consul documentation for further details.</p>
<h2>Multi-Threading</h2>
<p>The Consul Admin utilizes HTTP to communicate. It is threadsafe except for the methods marked as not, but has a mutex on the HTTP Send function, so only one value can be retrieved at a time.</p>
<p><a class="el" href="index.html">Go Home</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
