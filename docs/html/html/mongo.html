<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>AoSharedServiceLibrary: Mongo Interface</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AoSharedServiceLibrary
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Mongo Interface </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Mongo is a document-based database that allows for persistent, clusterable storage of data objects for services.</p>
<p>We can start by including the necessary headers </p><pre class="fragment">#include "include/aossl/mongo/mongo_interface.h"
#include "include/aossl/mongo/factory_mongo.h"
</pre><p>While Mongo utilizes a special brand of json known as 'BSON', the interface will take care of the translation. This means we can define our objects as json, and then feed them back to the interface. </p><pre class="fragment">std::string json = "{\"name\": {\"first\":\"Grace\", \"last\":\"Hopper\"}}";
std::string json2 = "{\"name\": {\"first\":\"Alex\", \"last\":\"Barry\"}}";

const char *json3 = "{\"name\": {\"first\":\"Keasha\", \"last\":\"Norton\"}, \"number\": 1}";
const char *json4 = "{\"name\": {\"first\":\"Gummy\", \"last\":\"Bear\"}, \"number\": 1}";

std::string key1;
std::string key2;
std::string key3;
std::string key4;
bool success;

MongoComponentFactory mongo_factory;
MongoInterface *mongo = mongo_factory.get_mongo_interface("mongodb://localhost:27017/", "mydb", "mycoll");
</pre><p>We can create a new object in the DB </p><pre class="fragment">key1 = mongo-&gt;create_document(json);

if ( !(key1.empty()) ) {
  std::cout &lt;&lt; "Document written to Mongo DB" &lt;&lt; std::endl;
}
</pre><p>We can load an existing object from the DB </p><pre class="fragment">std::string json_doc = mongo-&gt;load_document(key1);

std::cout &lt;&lt; "Document Loaded from Mongo: " &lt;&lt; json_doc &lt;&lt; std::endl;
</pre><p>Update an existing document </p><pre class="fragment">success = mongo-&gt;save_document(json2, key1);

if (success) {
  std::cout &lt;&lt; "Document written to Mongo DB" &lt;&lt; std::endl;
}
</pre><p>Delete a document from the DB </p><pre class="fragment">success = mongo-&gt;delete_document(key1);

if (success) {
  std::cout &lt;&lt; "Document deleted from Mongo DB" &lt;&lt; std::endl;
}
</pre><p>We can change the current collection using the collection name in an operation </p><pre class="fragment">key2 = mongo-&gt;create_document(json3, "newcoll");
</pre><p>Once we've set the current collection, we can continue to access that collection in the same manner as before </p><pre class="fragment">key3 = mongo-&gt;create_document(json4);
</pre><p>We also have the ability to run queries against the DB </p><pre class="fragment">MongoIteratorInterface *iter = NULL;
std::string query_string = "{\"number\": 1}";

std::cout &lt;&lt; "Executing Query:" &lt;&lt; query_string &lt;&lt; std::endl;
try {
  iter = mongo-&gt;query(query_string);
}
catch (std::exception&amp; e) {
  std::cout &lt;&lt; e.what() &lt;&lt; std::endl;
}

if (iter) {
  MongoResponseInterface *resp = iter-&gt;next();
  while (resp) {
    std::cout &lt;&lt; resp-&gt;get_value() &lt;&lt; std::endl;
    delete resp;
    resp = iter-&gt;next();
  }
  delete iter;
}
</pre><p><a class="el" href="index.html">Go Home</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
